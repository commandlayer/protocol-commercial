{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/ship/receipts/ship.receipt.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ship.receipt",
  "description": "Receipt for shipment / fulfillment events.",
  "allOf": [
    { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/receipt.base.schema.json" },
    {
      "type": "object",
      "properties": {
        "result": {
          "type": "object",
          "additionalProperties": false,
          "required": ["shipment_id", "order_id", "status"],
          "properties": {
            "shipment_id": { "type": "string", "minLength": 1, "maxLength": 128 },
            "shipment_group_id": { "type": "string", "minLength": 1, "maxLength": 128 },
            "order_id": { "type": "string", "minLength": 1, "maxLength": 128 },
            "status": { "type": "string", "enum": ["label_created", "in_transit", "delivered", "failed", "returned"] },
            "carrier": { "type": "string", "maxLength": 64 },
            "tracking_number": { "type": "string", "maxLength": 128, "pattern": "^[A-Za-z0-9][A-Za-z0-9-]{5,}$" },
            "tracking_url": { "type": "string", "format": "uri", "maxLength": 512 },
            "eta": { "type": "string", "format": "date-time" },
            "delivered_at": { "type": "string", "format": "date-time" },
            "metadata": {
              "type": "object",
              "additionalProperties": true,
              "maxProperties": 100,
              "propertyNames": { "type": "string", "maxLength": 64 }
            }
          }
        }
      },
      "required": ["result"],
      "allOf": [
        {
          "if": { "properties": { "status": { "const": "success" } }, "required": ["status"] },
          "then": { "type": "object", "properties": { "result": {} }, "required": ["result"] }
        },
        {
          "if": { "properties": { "status": { "const": "error" } }, "required": ["status"] },
          "then": { "type": "object", "properties": { "error": {}, "result": false }, "required": ["error"] }
        },
        {
          "if": {
            "type": "object",
            "properties": {
              "result": { "type": "object", "properties": { "status": { "enum": ["label_created", "in_transit", "delivered"] } } }
            }
          },
          "then": {
            "type": "object",
            "properties": {
              "result": {
                "type": "object",
                "properties": { "carrier": {}, "tracking_number": {} },
                "required": ["carrier", "tracking_number"]
              }
            }
          }
        }
      ]
    }
  ]
}
