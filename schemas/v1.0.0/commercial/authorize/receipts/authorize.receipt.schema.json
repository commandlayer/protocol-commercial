{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/authorize/receipts/authorize.receipt.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "authorize.receipt",
  "description": "Receipt for authorization; emits authorization artifact for capture/void.",
  "allOf": [
    { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/receipt.base.schema.json" },
    {
      "type": "object",
      "properties": {
        "result": {
          "type": "object",
          "additionalProperties": false,
          "required": ["authorization_id", "status"],
          "properties": {
            "authorization_id": { "type": "string", "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$" },
            "checkout_id": { "type": "string", "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$" },
            "status": { "type": "string", "enum": ["authorized", "declined", "expired", "canceled"] },
            "amount": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
            "settlement": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.settlement.schema.json" }] },
            "expires_at": { "type": "string", "format": "date-time" },
            "reason": { "type": "string", "maxLength": 1024 },
            "evidence": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "tx_hash": { "type": "string", "pattern": "^0x[a-fA-F0-9]{64}$" },
                "block_number": { "type": "integer", "minimum": 0 },
                "log_index": { "type": "integer", "minimum": 0 },
                "provider_ref": { "type": "string", "maxLength": 256 }
              }
            },
            "metadata": {
              "type": "object",
              "additionalProperties": true,
              "maxProperties": 100,
              "propertyNames": { "type": "string", "maxLength": 64 }
            }
          }
        }
      },
      "required": ["result"],
      "allOf": [
        { "if": { "properties": { "status": { "const": "success" } }, "required": ["status"] },
          "then": { "properties": { "result": {} }, "required": ["result"] } },
        { "if": { "properties": { "status": { "const": "error" } }, "required": ["status"] },
          "then": { "properties": { "error": {}, "result": false }, "required": ["error"] } },
        { "if": { "properties": { "result": { "properties": { "status": { "const": "authorized" } } } } },
          "then": { "properties": { "result": { "properties": { "amount": {}, "settlement": {} }, "required": ["amount", "settlement"] } } } },
        { "if": { "properties": { "result": { "properties": { "status": { "enum": ["declined", "canceled", "expired"] } } } } },
          "then": { "properties": { "result": { "properties": { "reason": {} }, "required": ["reason"] } } } }
      ]
    }
  ]
}
