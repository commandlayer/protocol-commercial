{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/checkout/requests/checkout.request.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "checkout.request",
  "description": "Request schema for initiating a checkout flow (cart, amount, and settlement details).",
  "type": "object",
  "additionalProperties": false,
  "required": ["x402", "trace", "customer", "amount", "settlement"],
  "properties": {
    "x402": {
      "allOf": [
        { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/x402.schema.json" }
      ]
    },
    "trace": {
      "allOf": [
        { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/trace.schema.json" }
      ]
    },
    "customer": {
      "description": "Logical customer identity for this checkout.",
      "allOf": [
        { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/identity.schema.json" }
      ]
    },
    "amount": {
      "description": "Total amount to be authorized or captured.",
      "allOf": [
        { "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }
      ]
    },
    "settlement": {
      "description": "Settlement destination and network context.",
      "allOf": [
        { "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.settlement.schema.json" }
      ]
    },
    "mode": {
      "description": "Checkout mode: authorize only, capture immediately, or authorize+capture.",
      "type": "string",
      "enum": ["authorize", "capture", "authorize_capture"]
    },
    "items": {
      "description": "Non-normative cart line items (for analytics, UX, and downstream logic).",
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "name", "quantity"],
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1,
            "maxLength": 128
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 256
          },
          "quantity": {
            "type": "number",
            "minimum": 0
          },
          "unit_price": {
            "description": "Optional per-unit display price (non-normative, not binding).",
            "type": "string",
            "maxLength": 64
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          }
        }
      },
      "maxItems": 256
    },
    "metadata": {
      "description": "Opaque, non-normative metadata (cart IDs, internal references, etc.).",
      "type": "object",
      "additionalProperties": true
    }
  }
}
