{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/checkout/receipts/checkout.receipt.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "checkout.receipt",
  "description": "Receipt for checkout; emits a checkout artifact for chaining into authorize/capture.",
  "allOf": [
    { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/receipt.base.schema.json" },
    {
      "type": "object",
      "properties": {
        "result": {
          "type": "object",
          "additionalProperties": false,
          "required": ["checkout_id", "status", "amount", "settlement", "items"],
          "properties": {
            "checkout_id": { "type": "string", "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$" },
            "status": { "type": "string", "enum": ["created", "failed", "canceled"] },
            "amount": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
            "settlement": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.settlement.schema.json" }] },
            "items": {
              "type": "array",
              "minItems": 1,
              "maxItems": 256,
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["sku", "quantity", "unit_price"],
                "properties": {
                  "sku": { "type": "string", "minLength": 1, "maxLength": 128 },
                  "quantity": { "type": "integer", "minimum": 1, "maximum": 1000000 },
                  "unit_price": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] }
                }
              }
            },
            "pricing": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "subtotal": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
                "tax": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
                "shipping": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
                "discount": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] }
              }
            },
            "expires_at": { "type": "string", "format": "date-time" },
            "next_action": { "type": "string", "enum": ["authorize", "abort"] },
            "metadata": {
              "type": "object",
              "additionalProperties": true,
              "maxProperties": 100,
              "propertyNames": { "type": "string", "maxLength": 64 }
            }
          }
        }
      },
      "required": ["result"],
      "allOf": [
        { "if": { "properties": { "status": { "const": "success" } }, "required": ["status"] },
          "then": { "type": "object", "properties": { "result": {} }, "required": ["result"] } },
        { "if": { "properties": { "status": { "const": "error" } }, "required": ["status"] },
          "then": { "type": "object", "properties": { "error": {}, "result": false }, "required": ["error"] } },
        { "if": { "type": "object", "properties": { "result": { "type": "object", "properties": { "status": { "enum": ["failed", "canceled"] } } } } },
          "then": { "type": "object", "properties": { "result": { "type": "object", "properties": { "metadata": {} }, "required": ["metadata"] } } } }
      ]
    }
  ]
}
