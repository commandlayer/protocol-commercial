{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/verify/receipts/verify.receipt.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "verify.receipt",
  "description": "Receipt for commercial verification; echoes providerâ€™s canonical view.",
  "allOf": [
    { "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/receipt.base.schema.json" },
    {
      "type": "object",
      "properties": {
        "result": {
          "type": "object",
          "additionalProperties": false,
          "required": ["target","verified","status"],
          "properties": {
            "target": { "type": "string", "minLength": 1, "maxLength": 256 },
            "verified": { "type": "boolean" },
            "status": { "type": "string", "enum": ["success","pending","failed","not_found"] },
            "amount": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
            "settlement": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.settlement.schema.json" }] },
            "evidence": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "tx_hash": { "type": "string", "pattern": "^0x[a-fA-F0-9]{64}$" },
                "block_number": { "type": "integer", "minimum": 0 },
                "log_index": { "type": "integer", "minimum": 0 },
                "provider_ref": { "type": "string", "maxLength": 256 }
              }
            },
            "reason": { "type": "string", "maxLength": 1024 },
            "metadata": {
              "type": "object",
              "additionalProperties": true,
              "maxProperties": 100,
              "propertyNames": { "type": "string", "maxLength": 64 }
            }
          }
        }
      },
      "required": ["result"],
      "allOf": [
        { "if": { "properties": { "status": { "const": "success" } }, "required": ["status"] }, "then": { "required": ["result"] } },
        { "if": { "properties": { "status": { "const": "error" } }, "required": ["status"] }, "then": { "required": ["error"], "properties": { "result": false } } },
        { "if": { "properties": { "result": { "properties": { "status": { "const": "not_found" } } } } }, "then": { "properties": { "result": { "properties": { "verified": { "const": false } } } } } },
        { "if": { "properties": { "result": { "properties": { "verified": { "const": false } } } } }, "then": { "properties": { "result": { "required": ["reason"] } } } }
      ]
    }
  ]
}
