{
  "$id": "https://commandlayer.org/schemas/v1.0.0/commercial/verify/requests/verify.request.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "verify.request",
  "description": "Verify a payment, invoice, transaction, or payout against providerâ€™s canonical view.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "x402": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/x402.schema.json" }] },
    "trace": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/trace.schema.json" }] },
    "payload": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "kind": { "type": "string", "enum": ["transaction", "payment", "invoice", "payout"] },
        "target": { "type": "string", "minLength": 1, "maxLength": 256 },
        "amount": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.amount.schema.json" }] },
        "settlement": { "allOf": [{ "$ref": "https://commandlayer.org/schemas/v1.0.0/commercial/_shared/payment.settlement.schema.json" }] },
        "window": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "from": { "type": "string", "format": "date-time" },
            "to": { "type": "string", "format": "date-time" }
          }
        },
        "strict": { "type": "boolean", "default": true },
        "metadata": {
          "type": "object",
          "additionalProperties": true,
          "maxProperties": 100,
          "propertyNames": { "type": "string", "maxLength": 64 }
        }
      },
      "required": ["kind", "target"],
      "allOf": [
        {
          "if": { "properties": { "strict": { "const": true } } },
          "then": {
            "anyOf": [
              { "type": "object", "required": ["amount"], "properties": { "amount": {} } },
              { "type": "object", "required": ["settlement"], "properties": { "settlement": {} } },
              { "type": "object", "required": ["window"], "properties": { "window": {} } }
            ]
          }
        },
        {
          "if": { "properties": { "kind": { "const": "transaction" } } },
          "then": { "type": "object", "properties": { "target": { "type": "string", "pattern": "^0x[a-fA-F0-9]{64}$" } } }
        }
      ]
    }
  },
  "required": ["x402", "trace", "payload"]
}
